# 查看运动记录数据 - 操作指南

## 概述

小花助手打卡小程序提供了多种查看运动记录数据的方法，方便开发者调试和验证运动记录功能。本文档详细介绍了如何查看和验证运动记录数据。

## 方法一：通过开发者工具Console查看

### 操作步骤

1. **打开微信开发者工具**
2. **进入Console面板**
3. **执行以下代码查看运动记录数据**

```javascript
// 获取完整用户数据
const userData = wx.getStorageSync('userData');
console.log('完整用户数据:', userData);

// 查看运动记录
console.log('运动记录:', userData.records.exercise);

// 查看运动记录数量
console.log('运动记录数量:', userData.records.exercise.length);

// 查看最近5条运动记录
const recentExercise = userData.records.exercise.slice(-5);
console.log('最近5条运动记录:', recentExercise);

// 查看今日运动记录
const today = '2025-06-20'; // 替换为当前日期
const todayExercise = userData.records.exercise.filter(
  record => record.date === today
);
console.log('今日运动记录:', todayExercise);
```

### 高级查询示例

```javascript
// 按运动类型统计
const exerciseByType = {};
userData.records.exercise.forEach(record => {
  if (!exerciseByType[record.type]) {
    exerciseByType[record.type] = {
      count: 0,
      totalDuration: 0,
      totalCalories: 0
    };
  }
  exerciseByType[record.type].count++;
  exerciseByType[record.type].totalDuration += record.duration;
  exerciseByType[record.type].totalCalories += record.calories;
});
console.log('按运动类型统计:', exerciseByType);

// 查找特定运动类型的记录
const runningRecords = userData.records.exercise.filter(
  record => record.type === '跑步'
);
console.log('跑步记录:', runningRecords);

// 计算总运动时长
const totalDuration = userData.records.exercise.reduce(
  (sum, record) => sum + record.duration, 0
);
console.log('总运动时长(分钟):', totalDuration);

// 计算总消耗卡路里
const totalCalories = userData.records.exercise.reduce(
  (sum, record) => sum + record.calories, 0
);
console.log('总消耗卡路里:', totalCalories);

// 查找最长的运动记录
const longestExercise = userData.records.exercise.reduce(
  (longest, current) => 
    current.duration > longest.duration ? current : longest,
  { duration: 0 }
);
console.log('最长的运动记录:', longestExercise);
```

## 方法二：通过页面功能查看

### 操作步骤

1. **打开小程序**
2. **进入首页**
3. **点击"运动打卡"按钮**
4. **查看运动记录列表**

### 运动记录页面验证

```javascript
// pages/exercise/exercise.js
Page({
  onLoad: function() {
    this.loadExerciseRecords();
  },
  
  loadExerciseRecords: function() {
    const app = getApp();
    const userData = app.getUserData();
    
    if (userData && userData.records.exercise) {
      console.log('从页面加载的运动记录:', userData.records.exercise);
      
      // 按日期倒序排序
      const sortedRecords = [...userData.records.exercise].sort(
        (a, b) => new Date(b.date) - new Date(a.date)
      );
      
      console.log('按日期倒序排序后的记录:', sortedRecords);
      
      this.setData({
        exerciseRecords: sortedRecords
      });
    }
  },
  
  // 添加运动记录后验证
  onAddRecord: function(record) {
    console.log('添加的运动记录:', record);
    
    const app = getApp();
    const success = app.addRecord('exercise', record);
    
    if (success) {
      console.log('运动记录添加成功');
      
      // 验证数据是否正确保存
      const userData = app.getUserData();
      const addedRecord = userData.records.exercise.find(
        r => r.id === record.id
      );
      
      if (addedRecord) {
        console.log('数据验证成功:', addedRecord);
      } else {
        console.error('数据验证失败: 记录未找到');
      }
      
      // 刷新页面数据
      this.loadExerciseRecords();
    } else {
      console.error('运动记录添加失败');
    }
  },
  
  // 删除运动记录后验证
  onDeleteRecord: function(recordId) {
    console.log('删除的记录ID:', recordId);
    
    const app = getApp();
    const success = app.deleteRecord('exercise', recordId);
    
    if (success) {
      console.log('运动记录删除成功');
      
      // 验证数据是否正确删除
      const userData = app.getUserData();
      const deletedRecord = userData.records.exercise.find(
        r => r.id === recordId
      );
      
      if (!deletedRecord) {
        console.log('数据验证成功: 记录已删除');
      } else {
        console.error('数据验证失败: 记录仍存在');
      }
      
      // 刷新页面数据
      this.loadExerciseRecords();
    } else {
      console.error('运动记录删除失败');
    }
  }
});
```

## 方法三：通过统计页面查看

### 操作步骤

1. **打开小程序**
2. **进入"统计"页面**
3. **查看运动数据统计**

### 统计页面数据验证

```javascript
// pages/statistics/statistics.js
Page({
  onLoad: function() {
    this.loadStatistics();
  },
  
  loadStatistics: function() {
    const app = getApp();
    const userData = app.getUserData();
    
    if (userData && userData.records.exercise) {
      console.log('统计页面加载的运动记录:', userData.records.exercise);
      
      // 计算统计数据
      const stats = {
        totalRecords: userData.records.exercise.length,
        totalDuration: userData.records.exercise.reduce(
          (sum, record) => sum + record.duration, 0
        ),
        totalCalories: userData.records.exercise.reduce(
          (sum, record) => sum + record.calories, 0
        ),
        averageDuration: 0,
        averageCalories: 0,
        mostFrequentType: ''
      };
      
      // 计算平均值
      if (stats.totalRecords > 0) {
        stats.averageDuration = stats.totalDuration / stats.totalRecords;
        stats.averageCalories = stats.totalCalories / stats.totalRecords;
      }
      
      // 找出最常见的运动类型
      const typeCount = {};
      userData.records.exercise.forEach(record => {
        typeCount[record.type] = (typeCount[record.type] || 0) + 1;
      });
      
      let maxCount = 0;
      for (const type in typeCount) {
        if (typeCount[type] > maxCount) {
          maxCount = typeCount[type];
          stats.mostFrequentType = type;
        }
      }
      
      console.log('运动统计数据:', stats);
      
      this.setData({
        exerciseStats: stats
      });
    }
  }
});
```

## 方法四：通过图表组件查看

### 操作步骤

1. **打开小程序**
2. **进入"统计"页面**
3. **查看运动数据图表**

### 图表数据验证

```javascript
// components/charts/exercise-pie.js
Component({
  methods: {
    loadChartData: function() {
      const app = getApp();
      const userData = app.getUserData();
      
      if (userData && userData.records.exercise) {
        console.log('图表组件加载的运动记录:', userData.records.exercise);
        
        // 按运动类型分组
        const typeData = {};
        userData.records.exercise.forEach(record => {
          if (!typeData[record.type]) {
            typeData[record.type] = {
              duration: 0,
              calories: 0,
              count: 0
            };
          }
          typeData[record.type].duration += record.duration;
          typeData[record.type].calories += record.calories;
          typeData[record.type].count++;
        });
        
        console.log('按类型分组的数据:', typeData);
        
        // 转换为图表数据格式
        const chartData = Object.keys(typeData).map(type => ({
          name: type,
          value: typeData[type].duration,
          count: typeData[type].count,
          calories: typeData[type].calories
        }));
        
        console.log('图表数据:', chartData);
        
        this.setData({
          chartData: chartData
        });
      }
    }
  }
});
```

## 数据结构验证

### 运动记录数据结构

```javascript
// 验证运动记录数据结构
function validateExerciseRecord(record) {
  const requiredFields = ['id', 'date', 'type', 'duration', 'calories'];
  const missingFields = requiredFields.filter(field => !(field in record));
  
  if (missingFields.length > 0) {
    console.error('运动记录缺少必要字段:', missingFields);
    return false;
  }
  
  // 验证字段类型
  if (typeof record.id !== 'string') {
    console.error('运动记录ID必须是字符串');
    return false;
  }
  
  if (typeof record.date !== 'string' || !/^\d{4}-\d{2}-\d{2}$/.test(record.date)) {
    console.error('运动记录日期格式错误，应为YYYY-MM-DD');
    return false;
  }
  
  if (typeof record.type !== 'string' || record.type.trim() === '') {
    console.error('运动记录类型不能为空');
    return false;
  }
  
  if (typeof record.duration !== 'number' || record.duration <= 0) {
    console.error('运动记录时长必须是正数');
    return false;
  }
  
  if (typeof record.calories !== 'number' || record.calories < 0) {
    console.error('运动记录卡路里必须是非负数');
    return false;
  }
  
  console.log('运动记录数据结构验证通过');
  return true;
}

// 使用示例
const userData = wx.getStorageSync('userData');
userData.records.exercise.forEach(record => {
  validateExerciseRecord(record);
});
```

### 批量验证所有运动记录

```javascript
// 批量验证所有运动记录
function validateAllExerciseRecords() {
  const userData = wx.getStorageSync('userData');
  
  if (!userData || !userData.records || !userData.records.exercise) {
    console.error('无法获取运动记录数据');
    return false;
  }
  
  const records = userData.records.exercise;
  let allValid = true;
  
  // 检查记录ID唯一性
  const idSet = new Set();
  const duplicateIds = [];
  
  records.forEach(record => {
    if (idSet.has(record.id)) {
      duplicateIds.push(record.id);
      allValid = false;
    } else {
      idSet.add(record.id);
    }
  });
  
  if (duplicateIds.length > 0) {
    console.error('发现重复的记录ID:', duplicateIds);
  }
  
  // 检查每条记录的结构
  records.forEach((record, index) => {
    if (!validateExerciseRecord(record)) {
      console.error(`第${index + 1}条运动记录验证失败:`, record);
      allValid = false;
    }
  });
  
  // 检查日期顺序
  const dates = records.map(record => new Date(record.date));
  for (let i = 1; i < dates.length; i++) {
    if (dates[i] < dates[i - 1]) {
      console.warn(`日期顺序异常: 第${i}条记录的日期早于第${i - 1}条记录`);
    }
  }
  
  if (allValid) {
    console.log('所有运动记录验证通过');
  } else {
    console.error('运动记录验证发现问题');
  }
  
  return allValid;
}

// 执行验证
validateAllExerciseRecords();
```

## 常见问题排查

### 1. 运动记录不显示

**排查步骤**:
```javascript
// 1. 检查数据是否存在
const userData = wx.getStorageSync('userData');
console.log('用户数据:', userData);

// 2. 检查运动记录数组
if (userData && userData.records && userData.records.exercise) {
  console.log('运动记录数组:', userData.records.exercise);
  console.log('运动记录数量:', userData.records.exercise.length);
} else {
  console.error('运动记录数据不存在或结构异常');
}

// 3. 检查页面数据绑定
console.log('页面数据:', this.data);

// 4. 检查数据加载时机
console.log('数据加载时间:', new Date().toISOString());
```

### 2. 运动记录保存失败

**排查步骤**:
```javascript
// 1. 检查存储空间
try {
  const info = wx.getStorageInfoSync();
  console.log('存储信息:', info);
  console.log('当前使用空间:', info.currentSize);
  console.log('剩余空间:', info.limitSize - info.currentSize);
} catch (e) {
  console.error('获取存储信息失败:', e);
}

// 2. 检查数据大小
const userData = wx.getStorageSync('userData');
const dataSize = JSON.stringify(userData).length;
console.log('数据大小:', dataSize, '字节');

// 3. 检查保存操作
try {
  const testRecord = {
    id: 'test_' + Date.now(),
    date: '2025-06-20',
    type: '测试',
    duration: 30,
    calories: 200,
    notes: '测试记录'
  };
  
  const app = getApp();
  const success = app.addRecord('exercise', testRecord);
  
  if (success) {
    console.log('测试记录添加成功');
    
    // 清理测试数据
    app.deleteRecord('exercise', testRecord.id);
    console.log('测试记录已清理');
  } else {
    console.error('测试记录添加失败');
  }
} catch (e) {
  console.error('保存操作异常:', e);
}
```

### 3. 运动记录图表不显示

**排查步骤**:
```javascript
// 1. 检查图表组件数据
const chartComponent = this.selectComponent('#exercisePieChart');
if (chartComponent) {
  console.log('图表组件数据:', chartComponent.data.chartData);
} else {
  console.error('找不到图表组件');
}

// 2. 检查图表数据格式
const app = getApp();
const userData = app.getUserData();

if (userData && userData.records.exercise) {
  // 按类型分组
  const typeData = {};
  userData.records.exercise.forEach(record => {
    if (!typeData[record.type]) {
      typeData[record.type] = 0;
    }
    typeData[record.type] += record.duration;
  });
  
  console.log('按类型分组的原始数据:', typeData);
  
  // 转换为图表数据格式
  const chartData = Object.keys(typeData).map(type => ({
    name: type,
    value: typeData[type]
  }));
  
  console.log('图表数据格式:', chartData);
} else {
  console.error('无法获取运动记录数据');
}

// 3. 检查图表渲染时机
console.log('图表渲染时间:', new Date().toISOString());
```

## 总结

小花助手打卡小程序提供了多种查看运动记录数据的方法：

1. **开发者工具Console查看**: 适合快速调试和数据验证
2. **页面功能查看**: 适合用户体验和功能测试
3. **统计页面查看**: 适合数据分析和趋势观察
4. **图表组件查看**: 适合可视化数据展示

通过合理使用这些方法，可以有效地验证运动记录数据的正确性，排查问题，并为用户提供更好的体验。同时，数据结构验证和常见问题排查指南可以帮助开发者快速定位和解决问题。