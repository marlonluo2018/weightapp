# å¼€å§‹ä¹‹æ—…åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

"å¼€å§‹ä¹‹æ—…"æ˜¯å‡è‚¥æ‰“å¡å¾®ä¿¡å°ç¨‹åºä¸­çš„ä¸€ä¸ª**é‡Œç¨‹ç¢‘åº†ç¥ç³»ç»Ÿ**ï¼Œæ—¨åœ¨é€šè¿‡é˜¶æ®µæ€§æˆå°±åº†ç¥æ¥æ¿€åŠ±ç”¨æˆ·åšæŒå‡è‚¥è®¡åˆ’ã€‚

## åŠŸèƒ½ä½ç½®

- **ä¸»è¦ç»„ä»¶**: `components/user-progress/user-progress.js`
- **ç•Œé¢æ–‡ä»¶**: `components/user-progress/user-progress.wxml`
- **æ ·å¼æ–‡ä»¶**: `components/user-progress/user-progress.wxss`

## é‡Œç¨‹ç¢‘èŠ‚ç‚¹

ç³»ç»Ÿå®šä¹‰äº†ä»¥ä¸‹é‡Œç¨‹ç¢‘èŠ‚ç‚¹ï¼š

| å¤©æ•° | é‡Œç¨‹ç¢‘æ ‡é¢˜ | æè¿° |
|------|------------|------|
| ç¬¬1å¤© | å¼€å§‹ä¹‹æ—… | æ­å–œä½ å¼€å§‹äº†å‡è‚¥ä¹‹æ—…ï¼ç»§ç»­ä¿æŒï¼ |
| ç¬¬7å¤© | ä¸€å‘¨è¾¾äºº | åšæŒä¸€å‘¨äº†ï¼ä½ å·²ç»å…»æˆäº†å¥½ä¹ æƒ¯ï¼ |
| ç¬¬14å¤© | åŒå‘¨åšæŒ | ä¸¤å‘¨çš„åšæŒï¼Œå¤ªæ£’äº†ï¼ç›®æ ‡å°±åœ¨å‰æ–¹ï¼ |
| ç¬¬30å¤© | æœˆåº¦å† å†› | åšæŒä¸€ä¸ªæœˆï¼ä½ å·²ç»æˆä¸ºæ›´å¥½çš„è‡ªå·±ï¼ |
| ç¬¬60å¤© | åŒæœˆè‹±é›„ | 60å¤©çš„åšæŒï¼ä½ çš„æ¯…åŠ›ä»¤äººæ•¬ä½©ï¼ |
| ç¬¬100å¤© | ç™¾æ—¥è¾¾äºº | 100å¤©ï¼ä½ åˆ›é€ äº†å±äºè‡ªå·±çš„å¥‡è¿¹ï¼ |

## æŠ€æœ¯å®ç°

### 1. å¤©æ•°è®¡ç®—é€»è¾‘

```javascript
// è®¡ç®—å‡è‚¥è®¡åˆ’å¼€å§‹å¤©æ•°
calculatePersistenceDays(userInfo) {
  // è·å–è®¡åˆ’å¼€å§‹æ—¥æœŸï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ä»Šå¤©
  const planStartDate = userInfo.planStartDate || app.formatDate(new Date());
  const startDate = new Date(planStartDate);
  const today = new Date();
  
  // è®¾ç½®æ—¶é—´ä¸ºåŒä¸€å¤©çš„å¼€å§‹æ—¶é—´ï¼Œé¿å…æ—¶é—´å·®å½±å“å¤©æ•°è®¡ç®—
  startDate.setHours(0, 0, 0, 0);
  today.setHours(0, 0, 0, 0);
  
  // è®¡ç®—å¤©æ•°å·®ï¼ˆåŒ…æ‹¬å¼€å§‹å½“å¤©ï¼‰
  const timeDiff = today.getTime() - startDate.getTime();
  const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1;
  
  return Math.max(1, daysDiff);
}
```

### 2. é‡Œç¨‹ç¢‘æ£€æµ‹

```javascript
// é‡Œç¨‹ç¢‘æ£€æµ‹
checkMilestones(persistenceDays) {
  const milestones = [
    { day: 1, title: 'å¼€å§‹ä¹‹æ—…', desc: 'æ­å–œä½ å¼€å§‹äº†å‡è‚¥ä¹‹æ—…ï¼ç»§ç»­ä¿æŒï¼' },
    { day: 7, title: 'ä¸€å‘¨è¾¾äºº', desc: 'åšæŒä¸€å‘¨äº†ï¼ä½ å·²ç»å…»æˆäº†å¥½ä¹ æƒ¯ï¼' },
    { day: 14, title: 'åŒå‘¨åšæŒ', desc: 'ä¸¤å‘¨çš„åšæŒï¼Œå¤ªæ£’äº†ï¼ç›®æ ‡å°±åœ¨å‰æ–¹ï¼' },
    { day: 30, title: 'æœˆåº¦å† å†›', desc: 'åšæŒä¸€ä¸ªæœˆï¼ä½ å·²ç»æˆä¸ºæ›´å¥½çš„è‡ªå·±ï¼' },
    { day: 60, title: 'åŒæœˆè‹±é›„', desc: '60å¤©çš„åšæŒï¼ä½ çš„æ¯…åŠ›ä»¤äººæ•¬ä½©ï¼' },
    { day: 100, title: 'ç™¾æ—¥è¾¾äºº', desc: '100å¤©ï¼ä½ åˆ›é€ äº†å±äºè‡ªå·±çš„å¥‡è¿¹ï¼' }
  ];

  for (const milestone of milestones) {
    if (persistenceDays === milestone.day) {
      // ç‰¹æ®Šå¤„ç†ç¬¬1å¤©çš„é‡Œç¨‹ç¢‘ï¼Œåªæ˜¾ç¤ºä¸€æ¬¡
      if (milestone.day === 1) {
        if (!this.data.hasShownFirstDayMilestone) {
          this.showMilestoneCelebration(milestone);
          this.setData({ 
            lastMilestoneDay: milestone.day,
            hasShownFirstDayMilestone: true 
          });
        }
      } else {
        this.showMilestoneCelebration(milestone);
        this.setData({ lastMilestoneDay: milestone.day });
      }
      break;
    }
  }
}
```

### 3. åº†ç¥å¼¹çª—æ˜¾ç¤º

```javascript
// æ˜¾ç¤ºé‡Œç¨‹ç¢‘åº†ç¥
showMilestoneCelebration(milestone) {
  this.setData({
    showMilestone: true,
    milestone: milestone
  });
}
```

## è§¦å‘æ—¶æœº

- **ç»„ä»¶åŠ è½½æ—¶**: `attached()` ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­è°ƒç”¨ `calculateProgress()`
- **é¡µé¢æ˜¾ç¤ºæ—¶**: `pageLifetimes.show()` ä¸­è°ƒç”¨ `calculateProgress()`
- **ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ—¶**: ç›‘å¬ `userProfileUpdated` äº‹ä»¶

## ç•Œé¢å±•ç¤º

### åº†ç¥å¼¹çª—ç»“æ„
```xml
<!-- é‡Œç¨‹ç¢‘åº†ç¥ -->
<view class="milestone-celebration" wx:if="{{showMilestone}}">
  <view class="celebration-content">
    <text class="celebration-emoji">ğŸ‰</text>
    <text class="celebration-title">{{milestone.title}}</text>
    <text class="celebration-desc">{{milestone.description}}</text>
    <button class="celebration-btn" bindtap="closeCelebration">å¤ªæ£’äº†ï¼</button>
  </view>
</view>
```

### æ ·å¼ç‰¹æ€§
- å…¨å±é®ç½©å±‚æ˜¾ç¤º
- å¼¹çª—å±…ä¸­åŠ¨ç”»æ•ˆæœ
- è¡¨æƒ…ç¬¦å·å¼¹è·³åŠ¨ç”»
- æ¸å˜æŒ‰é’®è®¾è®¡

## æ•°æ®å­˜å‚¨

### ç”¨æˆ·æ•°æ®ç»“æ„
```javascript
userData = {
  profile: {
    nickname: 'ç”¨æˆ·',
    avatar: '',
    targetWeight: 60,
    currentWeight: 65,
    initialWeight: 70,
    height: 170,
    targetDate: '',
    plan: '',
    planStartDate: '2025-10-08'  // æ–°å¢å­—æ®µï¼Œè®°å½•è®¡åˆ’å¼€å§‹æ—¥æœŸ
  },
  records: {
    exercise: [],
    diet: [],
    weight: []
  }
}
```

## é—®é¢˜ä¿®å¤å†å²

### é—®é¢˜1ï¼šæ¯å¤©éƒ½æ˜¯"å¼€å§‹ä¹‹æ—…"
**åŸå› **: 
- æ•°æ®åˆå§‹åŒ–æ—¶æ²¡æœ‰è®¾ç½® `planStartDate` å­—æ®µ
- æ¯æ¬¡è®¡ç®—å¤©æ•°æ—¶éƒ½ä½¿ç”¨å½“å¤©ä½œä¸ºå¼€å§‹æ—¥æœŸ

**è§£å†³æ–¹æ¡ˆ**:
- åœ¨ `app.js` åˆå§‹åŒ–ç”¨æˆ·æ•°æ®æ—¶æ·»åŠ  `planStartDate: app.formatDate(new Date())`

### é—®é¢˜2ï¼šé‡Œç¨‹ç¢‘æ£€æµ‹é”™è¯¯
**åŸå› **:
- é”™è¯¯åœ°å°†è¿ç»­æ‰“å¡å¤©æ•°ä¼ é€’ç»™é‡Œç¨‹ç¢‘æ£€æµ‹å‡½æ•°

**è§£å†³æ–¹æ¡ˆ**:
- å°† `this.checkMilestones(consecutiveDays)` æ”¹ä¸º `this.checkMilestones(persistenceDays)`

### é—®é¢˜3ï¼šåº†ç¥å¼¹çª—ä¸æ˜¾ç¤º
**åŸå› **:
- é‡Œç¨‹ç¢‘æ¡ä»¶åˆ¤æ–­è¿‡ä¸¥ï¼š`this.data.lastMilestoneDay < milestone.day`

**è§£å†³æ–¹æ¡ˆ**:
- ç§»é™¤è¿‡ä¸¥çš„æ¡ä»¶åˆ¤æ–­
- æ·»åŠ ç¬¬1å¤©é‡Œç¨‹ç¢‘åªæ˜¾ç¤ºä¸€æ¬¡çš„é€»è¾‘

## ä½¿ç”¨è¯´æ˜

1. **é¦–æ¬¡ä½¿ç”¨**:
   - ç”¨æˆ·ç¬¬ä¸€æ¬¡æ‰“å¼€å°ç¨‹åºå¹¶è¿›å…¥ä¸ªäººèµ„æ–™é¡µé¢æ—¶ï¼Œä¼šçœ‹åˆ°æ¬¢è¿æç¤º
   - æç¤ºç”¨æˆ·å®Œå–„ä¸ªäººä¿¡æ¯å’Œå‡è‚¥è®¡åˆ’ä»¥è·å¾—æ›´å‡†ç¡®çš„å»ºè®®
   - ç”¨æˆ·ç¡®è®¤åï¼Œç³»ç»Ÿä¼šæ ‡è®°ä¸ºéé¦–æ¬¡ä½¿ç”¨
   - éšåä¼šæ˜¾ç¤º"å¼€å§‹ä¹‹æ—…"åº†ç¥å¼¹çª—

2. **æŒç»­ä½¿ç”¨**: ç³»ç»Ÿä¼šè®°å½•è®¡åˆ’å¼€å§‹æ—¥æœŸï¼Œå¤©æ•°ä¼šæ­£å¸¸ç´¯è®¡
3. **é‡Œç¨‹ç¢‘è§¦å‘**: è¾¾åˆ°ç‰¹å®šå¤©æ•°æ—¶ä¼šè‡ªåŠ¨æ˜¾ç¤ºå¯¹åº”çš„åº†ç¥å¼¹çª—
4. **å¼¹çª—å…³é—­**: ç‚¹å‡»"å¤ªæ£’äº†ï¼"æŒ‰é’®å…³é—­åº†ç¥å¼¹çª—

## è®¾è®¡ç›®çš„

- **å¢å¼ºç”¨æˆ·åŠ¨åŠ›**: é€šè¿‡é˜¶æ®µæ€§æˆå°±åº†ç¥æ¿€åŠ±ç”¨æˆ·åšæŒ
- **æä¾›æ­£å‘åé¦ˆ**: è®©ç”¨æˆ·æ„Ÿå—åˆ°è¿›æ­¥å’Œæˆå°±
- **å»ºç«‹ä½¿ç”¨ä¹ æƒ¯**: é€šè¿‡é‡Œç¨‹ç¢‘ç³»ç»ŸåŸ¹å…»æŒç»­æ‰“å¡çš„ä¹ æƒ¯
- **æå‡ç”¨æˆ·ä½“éªŒ**: å¢åŠ è¶£å‘³æ€§å’Œäº’åŠ¨æ€§

## æ–°å¢åŠŸèƒ½ï¼šé¦–æ¬¡ä½¿ç”¨æ¬¢è¿æç¤º

### åŠŸèƒ½æ¦‚è¿°
æ–°å¢äº†é¦–æ¬¡ä½¿ç”¨æ¬¢è¿æç¤ºåŠŸèƒ½ï¼Œä¸ºç¬¬ä¸€æ¬¡ä½¿ç”¨å°ç¨‹åºçš„ç”¨æˆ·æä¾›å‹å¥½çš„å¼•å¯¼ã€‚

### æŠ€æœ¯å®ç°
1. **é¦–æ¬¡ä½¿ç”¨æ£€æµ‹** (`app.js`)
   ```javascript
   // åœ¨åˆå§‹åŒ–ç”¨æˆ·æ•°æ®æ—¶æ·»åŠ é¦–æ¬¡ä½¿ç”¨æ ‡å¿—
   userData = {
     profile: {
       // ...å…¶ä»–å­—æ®µ...
       isFirstTime: true  // é¦–æ¬¡ä½¿ç”¨æ ‡å¿—
     }
   }
   ```

2. **æ¬¢è¿æç¤ºæ˜¾ç¤º** (`pages/profile/profile.js`)
   ```javascript
   // æ£€æŸ¥æ˜¯å¦æ˜¯é¦–æ¬¡ä½¿ç”¨
   if (finalProfile.isFirstTime) {
     setTimeout(() => {
       this.showFirstTimeWelcome();
     }, 1000);
   }

   // æ˜¾ç¤ºæ¬¢è¿æç¤º
   showFirstTimeWelcome: function() {
     wx.showModal({
       title: 'æ¬¢è¿ä½¿ç”¨å‡è‚¥è®°å½•å°ç¨‹åº',
       content: 'æ¬¢è¿ï¼ä¸ºäº†æ›´å¥½åœ°ä¸ºæ‚¨æœåŠ¡ï¼Œè¯·å…ˆå®Œå–„æ‚¨çš„ä¸ªäººä¿¡æ¯å’Œå‡è‚¥è®¡åˆ’...',
       showCancel: false,
       confirmText: 'çŸ¥é“äº†'
     });
   }
   ```

3. **ä¸"å¼€å§‹ä¹‹æ—…"åè°ƒ** (`components/user-progress/user-progress.js`)
   ```javascript
   // é¦–æ¬¡ä½¿ç”¨ç”¨æˆ·å»¶è¿Ÿæ˜¾ç¤º"å¼€å§‹ä¹‹æ—…"åº†ç¥
   if (isFirstTime) {
     setTimeout(() => {
       this.showMilestoneCelebration(milestone);
     }, 2000);
   }
   ```

### ç”¨æˆ·ä½“éªŒæµç¨‹
1. é¦–æ¬¡ç”¨æˆ·è¿›å…¥ä¸ªäººèµ„æ–™é¡µé¢
2. æ˜¾ç¤ºæ¬¢è¿æç¤ºï¼ˆ1ç§’å»¶è¿Ÿï¼‰
3. ç”¨æˆ·ç‚¹å‡»"çŸ¥é“äº†"ç¡®è®¤
4. æ˜¾ç¤º"å¼€å§‹ä¹‹æ—…"åº†ç¥å¼¹çª—ï¼ˆ2ç§’å»¶è¿Ÿï¼‰

## æ³¨æ„äº‹é¡¹

- ç¬¬1å¤©çš„é‡Œç¨‹ç¢‘åªä¼šæ˜¾ç¤ºä¸€æ¬¡ï¼Œé¿å…é‡å¤æ‰“æ‰°ç”¨æˆ·
- é‡Œç¨‹ç¢‘åŸºäºå‡è‚¥è®¡åˆ’å¼€å§‹å¤©æ•°ï¼Œä¸æ˜¯è¿ç»­æ‰“å¡å¤©æ•°
- ç³»ç»Ÿä¼šè‡ªåŠ¨ä¿å­˜è®¡åˆ’å¼€å§‹æ—¥æœŸï¼Œç¡®ä¿å¤©æ•°è®¡ç®—å‡†ç¡®
- åº†ç¥å¼¹çª—å¯ä»¥æ‰‹åŠ¨å…³é—­ï¼Œä¸ä¼šå¼ºåˆ¶ç”¨æˆ·è§‚çœ‹
- é¦–æ¬¡ä½¿ç”¨æ¬¢è¿æç¤ºä¸"å¼€å§‹ä¹‹æ—…"åº†ç¥æœ‰åè°ƒçš„æ˜¾ç¤ºæ—¶æœº