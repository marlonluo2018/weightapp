<!--statistics.wxml-->
<view class="container">

  <view class="page-header">
    <text class="page-title">ç»Ÿè®¡æ•°æ®</text>
  </view>

  <!-- æ—¶é—´ç­›é€‰ -->
  <view class="card filter-section">
    <view class="filter-tabs">
      <button class="filter-tab {{activeTab === 'week' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="week">æœ¬å‘¨</button>
      <button class="filter-tab {{activeTab === 'month' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="month">æœ¬æœˆ</button>
      <button class="filter-tab {{activeTab === 'all' ? 'active' : ''}}"
              bindtap="switchTab" data-tab="all">å…¨éƒ¨</button>
    </view>
  </view>

  <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
  <view class="card overview-stats">
    <view class="card-title">ç»Ÿè®¡æ¦‚è§ˆ</view>
    <view class="stats-grid">
      <view class="stat-card exercise-stat">
        <text class="stat-icon">ğŸƒ</text>
        <text class="stat-value">{{overviewStats.exercise.totalMinutes}}</text>
        <text class="stat-label">æ€»è¿åŠ¨(åˆ†é’Ÿ)</text>
        <text class="stat-detail">{{overviewStats.exercise.sessions}}æ¬¡</text>
      </view>
      <view class="stat-card diet-stat">
        <text class="stat-icon">ğŸ½ï¸</text>
        <text class="stat-value">{{overviewStats.diet.totalRecords}}</text>
        <text class="stat-label">é¥®é£Ÿè®°å½•</text>
        <text class="stat-detail">{{overviewStats.diet.totalCalories}}å¡è·¯é‡Œ</text>
      </view>
      <view class="stat-card weight-stat">
        <text class="stat-icon">âš–ï¸</text>
        <text class="stat-value">{{overviewStats.weight.change}}</text>
        <text class="stat-label">ä½“é‡å˜åŒ–</text>
        <text class="stat-detail">{{overviewStats.weight.records}}æ¬¡è®°å½•</text>
      </view>
    </view>
  </view>

  <!-- ä½“é‡è¶‹åŠ¿å›¾è¡¨ -->
  <simple-weight-chart data="{{weightHistory}}"></simple-weight-chart>

  <!-- è¿åŠ¨ç»Ÿè®¡ -->
  <view class="card exercise-stats" wx:if="{{exerciseStats.length > 0}}">
    <view class="card-title">è¿åŠ¨è¯¦æƒ…</view>
    <view class="stats-list">
      <view class="stats-item" wx:for="{{exerciseStats}}" wx:key="type">
        <view class="stats-info">
          <text class="stats-name">{{item.type}}</text>
          <text class="stats-count">{{item.count}}æ¬¡</text>
        </view>
        <view class="stats-details">
          <text class="stats-duration">{{item.totalDuration}}åˆ†é’Ÿ</text>
          <text class="stats-calories" wx:if="{{item.totalCalories}}">{{item.totalCalories}}å¡</text>
        </view>
        <view class="progress-bar">
          <view class="progress-fill progress-{{item.percentage || 0}}"></view>
        </view>
      </view>
    </view>
  </view>

  
  <!-- é¥®é£Ÿåˆ†æ -->
  <view class="card diet-analysis" wx:if="{{dietAnalysis.mealTypes.length > 0}}">
    <view class="card-title">é¥®é£Ÿåˆ†æ</view>
    <view class="meal-stats">
      <view class="meal-stat-item" wx:for="{{dietAnalysis.mealTypes}}" wx:key="mealType">
        <view class="meal-info">
          <text class="meal-name">{{item.mealTypeText}}</text>
          <text class="meal-count">{{item.count}}æ¬¡</text>
        </view>
        <view class="meal-calories">
          <text class="calories-text">{{item.totalCalories}}å¡è·¯é‡Œ</text>
        </view>
        <view class="meal-percentage">{{item.percentage}}%</view>
      </view>
    </view>
  </view>

  <!-- æ—¥å†çƒ­åŠ›å›¾ -->
  <view class="card calendar-heatmap" wx:if="{{calendarData.length > 0}}">
    <view class="card-title">æ´»è·ƒåº¦æ—¥å†</view>

    <!-- æœˆä»½ç¿»é˜…æ§åˆ¶ -->
    <view class="calendar-month-navigation" wx:if="{{activeTab === 'all'}}">
      <button class="calendar-month-nav-btn" bindtap="previousMonth" disabled="{{!canGoPrevious}}">
        <text class="nav-arrow">â€¹</text>
      </button>
      <text class="current-month">{{currentMonthDisplay || 'é€‰æ‹©æœˆä»½'}}</text>
      <button class="calendar-month-nav-btn" bindtap="nextMonth" disabled="{{!canGoNext}}">
        <text class="nav-arrow">â€º</text>
      </button>
    </view>

    <view class="calendar-legend">
      <text>å°‘</text>
      <view class="legend-colors">
        <view class="legend-color legend-color-1"></view>
        <view class="legend-color legend-color-2"></view>
        <view class="legend-color legend-color-3"></view>
        <view class="legend-color legend-color-4"></view>
        <view class="legend-color legend-color-5"></view>
      </view>
      <text>å¤š</text>
    </view>

    <!-- æ˜ŸæœŸæ ‡é¢˜ -->
    <view class="calendar-weekdays">
      <text class="weekday">æ—¥</text>
      <text class="weekday">ä¸€</text>
      <text class="weekday">äºŒ</text>
      <text class="weekday">ä¸‰</text>
      <text class="weekday">å››</text>
      <text class="weekday">äº”</text>
      <text class="weekday">å…­</text>
    </view>

    <view class="calendar-grid">
      <view class="calendar-week" wx:for="{{calendarData}}" wx:key="weekIndex">
        <view class="calendar-day {{day.className}} {{day.isToday ? 'today' : ''}}"
              wx:for="{{item.days}}"
              wx:for-item="day"
              wx:key="dayIndex"
              bindtap="showDayDetail"
              data-date="{{day.date}}">
          <text class="day-date" wx:if="{{day.date}}">{{day.day}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æˆå°±å¾½ç«  -->
  <view class="card achievements" wx:if="{{achievements.length > 0}}">
    <view class="card-title">æˆå°±å¾½ç« </view>
    <view class="achievements-grid">
      <view class="achievement-item {{item.unlocked ? 'unlocked' : 'locked'}}"
            wx:for="{{achievements}}"
            wx:key="id">
        <text class="achievement-icon">{{item.icon}}</text>
        <text class="achievement-name">{{item.name}}</text>
        <text class="achievement-desc">{{item.description}}</text>
      </view>
    </view>
  </view>
</view>