<!--weight.wxml-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">ä½“é‡è®°å½•</text>
  </view>

  <!-- å½“å‰ä½“é‡å¡ç‰‡ -->
  <view class="card current-weight">
    <view class="card-title">å½“å‰ä½“é‡</view>
    <view class="weight-display">
      <text class="weight-value">{{currentWeight}}</text>
      <text class="weight-unit">kg</text>
    </view>
    <text class="update-time">{{lastUpdateTime ? 'æ›´æ–°äº ' + lastUpdateTime : 'æš‚æ— è®°å½•'}}</text>
  </view>

  <!-- å¿«é€Ÿè®°å½• -->
  <view class="card quick-record">
    <view class="card-title">å¿«é€Ÿè®°å½•ä½“é‡</view>

    <!-- ä»Šæ—¥è®°å½•æç¤º -->
    <view class="today-record-notice" wx:if="{{hasTodayRecord}}">
      <text class="notice-icon">âš ï¸</text>
      <text class="notice-text">ä»Šå¤©å·²æœ‰ä½“é‡è®°å½•ï¼š{{todayRecordWeight}}kgï¼Œæ–°è®°å½•å°†è¦†ç›–ä¹‹å‰çš„è®°å½•</text>
    </view>

    <view class="weight-input-section">
      <view class="input-group">
        <input class="weight-input" type="digit" placeholder="è¾“å…¥ä½“é‡"
               value="{{newWeight}}" bindinput="onWeightInput" />
        <text class="unit-text">kg</text>
      </view>

      <view class="date-section">
        <text class="section-label">è®°å½•æ—¥æœŸ</text>
        <picker mode="date" value="{{recordDate}}" bindchange="onDateChange">
          <view class="date-picker">
            <text>{{recordDate || 'é€‰æ‹©æ—¥æœŸ'}}</text>
            <text class="calendar-icon">ğŸ“…</text>
          </view>
        </picker>
      </view>

      <view class="time-section">
        <text class="section-label">è®°å½•æ—¶é—´</text>
        <picker mode="time" value="{{recordTime}}" bindchange="onTimeChange">
          <view class="time-picker">
            <text>{{recordTime || 'é€‰æ‹©æ—¶é—´'}}</text>
            <text class="clock-icon">ğŸ•’</text>
          </view>
        </picker>
      </view>

      <view class="form-item">
        <text class="form-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
        <textarea class="input textarea" placeholder="è®°å½•ä½“é‡å˜åŒ–çš„åŸå› ã€èº«ä½“çŠ¶å†µç­‰"
                  value="{{notes}}" bindinput="onNotesInput"></textarea>
      </view>
    </view>

    <button class="btn submit-btn" bindtap="saveWeight" disabled="{{!canSave}}">
      ä¿å­˜ä½“é‡è®°å½•
    </button>
  </view>

  <!-- ä½“é‡è¶‹åŠ¿ -->
  <view class="card weight-trend" wx:if="{{weightHistory.length > 1}}">
    <view class="card-title">ä½“é‡è¶‹åŠ¿</view>
    <view class="trend-stats">
      <view class="trend-item">
        <text class="trend-label">æœ¬å‘¨å˜åŒ–</text>
        <text class="trend-value {{weekChange >= 0 ? 'weight-up' : 'weight-down'}}">
          {{weekChange >= 0 ? '+' : ''}}{{weekChange}}kg
        </text>
      </view>
      <view class="trend-item">
        <text class="trend-label">æœ¬æœˆå˜åŒ–</text>
        <text class="trend-value {{monthChange >= 0 ? 'weight-up' : 'weight-down'}}">
          {{monthChange >= 0 ? '+' : ''}}{{monthChange}}kg
        </text>
      </view>
      <view class="trend-item">
        <text class="trend-label">æ€»ä½“å˜åŒ–</text>
        <text class="trend-value {{totalChange >= 0 ? 'weight-up' : 'weight-down'}}">
          {{totalChange >= 0 ? '+' : ''}}{{totalChange}}kg
        </text>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="card history-records" wx:if="{{weightHistory.length > 0}}">
    <view class="card-title">å†å²è®°å½•</view>
    <view class="history-list">
      <view class="history-item" wx:for="{{weightHistory}}" wx:key="id">
        <view class="history-info">
          <view class="history-weight">
            <text class="weight-text">{{item.weight}}kg</text>
            <text class="weight-change {{item.change >= 0 ? 'weight-up' : 'weight-down'}}" wx:if="{{item.change !== 0}}">
              {{item.change >= 0 ? 'â†‘' : 'â†“'}}{{Math.abs(item.change)}}kg
            </text>
          </view>
          <text class="history-date">{{item.displayTime}}</text>
          <text class="history-notes" wx:if="{{item.notes}}">{{item.notes}}</text>
        </view>
        <button class="btn btn-small btn-danger" bindtap="deleteRecord" data-id="{{item.id}}">
          åˆ é™¤
        </button>
      </view>
    </view>
  </view>

  <!-- ä½“é‡ç›®æ ‡ -->
  <view class="card weight-goal">
    <view class="card-title">ä½“é‡ç›®æ ‡</view>
    <view class="goal-info">
      <view class="goal-item">
        <text class="goal-label">ç›®æ ‡ä½“é‡</text>
        <text class="goal-value">{{targetWeight}}kg</text>
      </view>
      <view class="goal-item">
        <text class="goal-label">è·ç¦»ç›®æ ‡</text>
        <text class="goal-value {{distanceToGoal >= 0 ? 'positive' : 'negative'}}">
          {{distanceToGoal >= 0 ? 'è¿˜éœ€å‡' : 'å·²è¶…è¿‡'}}{{Math.abs(distanceToGoal)}}kg
        </text>
      </view>
    </view>
  </view>
</view>